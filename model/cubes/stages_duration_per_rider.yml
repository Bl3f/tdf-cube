cubes:
  - name: stages_duration_per_rider
    sql_table: letour.stages_duration_per_rider

    joins:
      - name: stg_stages_info
        sql: "{CUBE}.stage_id = {stg_stages_info}.stage"
        relationship: many_to_one

      - name: stg_riders
        sql: "{CUBE}.rider_slug = {stg_riders}.slug"
        relationship: many_to_one

    dimensions:
      - name: id
        sql: id
        type: string
        title: id
        primary_key: true
        description: A primary key that is the concatenation of the rider_slug and the stage.

      - name: rider
        sql: rider_slug
        type: string
        title: rider
        description: The Strava profile id.

      - name: stage
        sql: stage_id
        type: string
        title: stage
        description: "The Tour stage id, from 01 to 21. Be careful the format of the stage id is left padded with a 0. It means for stage 1, it's 01. For stage 2 it's 02, etc. The operation to do it in SQL is: LPAD(column_name, 2, '0')."

    measures:
      - name: count
        type: count

      - name: duration
        sql: duration
        type: avg
        title: duration
        description: Time in seconds (s) the rider took to complete the stage from the start line to the finish line. When displaying this column it's between to convert the seconds (s) to h:m:s.

    pre_aggregations:
      # Pre-aggregation definitions go here.
      # Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started

